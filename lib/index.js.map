{"version":3,"file":"index.js","sources":["../src/index.js"],"sourcesContent":["import React from \"react\";\nimport ReactDOM ,{findDOMNode} from \"react-dom\";\nimport PropTypes from \"prop-types\";\n\nclass ReactToPrint extends React.Component {\n\n  static propTypes = {\n    /** Copy styles over into print window. default: true */\n    copyStyles: PropTypes.bool,\n    /** auto open print dialog */\n    showPreview: PropTypes.bool,\n    /** Trigger action used to open browser print */\n    trigger: PropTypes.func.isRequired,\n    /** Content to be printed */\n    content: PropTypes.func.isRequired,\n    /** Callback function to trigger before print */\n    onBeforePrint: PropTypes.func,\n    /** Optional class to pass to the print window body */\n    bodyClass: PropTypes.string,\n    printButton: PropTypes.element,\n    cancelButton: PropTypes.element,\n  };\n\n  static defaultProps = {\n    copyStyles: true,\n    closeAfterPrint: true,\n    bodyClass: '',\n  };\n\n  triggerPrint(target) {\n    if (this.props.onBeforePrint) {\n      this.props.onBeforePrint();\n    }\n    if(!this.props.showPreview){\n      //when print right away add time to load\n      setTimeout(() => {\n        target.contentWindow.focus();\n        target.contentWindow.print();\n        this.removeWindow(target);\n      }, 500);\n    }else {\n      target.contentWindow.focus();\n      target.contentWindow.print();\n      this.removeWindow(target);\n    }\n  }\n\n  manualPrint(target){\n    if (this.linkLoaded === this.linkTotal) {\n      this.triggerPrint(target);\n    }\n    if (this.props.copyStyles === false && this.linkTotal === 0){\n      this.triggerPrint(target);\n    }\n  }\n\n  removeWindow(target) {\n    // setTimeout(() => {\n      target.parentNode.removeChild(target);\n    // }, 100);\n    //why delay\n  }\n\n  handlePrint = () => {\n    console.log('handlePrint')\n    const {\n      content,\n      copyStyles,\n      onAfterPrint,\n      showPreview,\n      printButton,\n      cancelButton\n    } = this.props;\n    this.loadtriggered= false\n\n    let printWindow = document.createElement('iframe');\n    printWindow.style.position = 'absolute';\n    if(showPreview){\n      printWindow.style.top = '0px';\n      printWindow.style.left = '0px';\n      printWindow.style.width = '800px';\n      printWindow.style.height = '100vh';\n      printWindow.style.borderWidth = '0px 2px';\n      printWindow.style.backgroundColor = '#fff';\n    }else {\n      printWindow.style.top = '-1000px';\n      printWindow.style.left = '-1000px';\n\n    }\n\n    const contentEl = content();\n    const contentNodes = findDOMNode(contentEl);\n\n    const linkNodes = document.querySelectorAll('link[rel=\"stylesheet\"]');\n\n    this.linkTotal = linkNodes.length || 0;\n    this.linkLoaded = 0;\n\n    const markLoaded = (type) => {\n\n      this.linkLoaded++;\n\n      if (this.linkLoaded === this.linkTotal&&!showPreview) {\n        this.triggerPrint(printWindow);\n      }\n\n    };\n\n    printWindow.onload = () => {\n      if(this.loadtriggered){\n        return\n      }\n      this.loadtriggered= true\n\n      let domDoc = printWindow.contentDocument || printWindow.contentWindow.document;\n\n      domDoc.open();\n      domDoc.write(contentNodes.outerHTML);\n      domDoc.close();\n\n      let styleEl = domDoc.createElement('style');\n      styleEl.appendChild(domDoc.createTextNode(\n          \"@page { size: auto;  margin: 0mm; }\" +\n          \" @media print {\" +\n          \" body { -webkit-print-color-adjust: exact; }\" +\n          \" .printButtonInnerClassName{display: none;}\" +\n          \" .cancelButtonInnerClassName{display: none;}\" +\n          \"}\"));\n      domDoc.head.appendChild(styleEl);\n\n      if (printButton) {\n        let printELe = React.cloneElement(printButton, {})\n        let printNode = document.createElement(\"div\");\n        printNode.addEventListener(\"click\", () => {\n          this.manualPrint(printWindow)\n        })\n        ReactDOM.render(printELe, printNode)\n        printNode.className += ' printButtonInnerClassName'\n        domDoc.body.appendChild(printNode);\n      }\n\n      if (cancelButton) {\n        let cancelEle = React.cloneElement(cancelButton, {})\n        let cancelNode = document.createElement(\"div\");\n        cancelNode.addEventListener(\"click\", () => {\n          printWindow.style.display = 'none'\n          this.removeWindow(printWindow);\n        })\n        ReactDOM.render(cancelEle, cancelNode)\n        cancelNode.className += ' cancelButtonInnerClassName'\n        domDoc.body.appendChild(cancelNode);\n      }\n\n      if (copyStyles !== false) {\n\n        const headEls = document.querySelectorAll('style, link[rel=\"stylesheet\"]');\n        let styleCSS = \"\";\n\n        [...headEls].forEach(node => {\n\n          if (node.tagName === 'STYLE') {\n\n            if (node.sheet) {\n              for (let i = 0; i < node.sheet.cssRules.length; i++) {\n                styleCSS += node.sheet.cssRules[i].cssText + \"\\r\\n\";\n              }\n\n            }\n\n          } else {\n\n            let newHeadEl = domDoc.createElement(node.tagName);\n\n            let attributes = [...node.attributes];\n            attributes.forEach(attr => {\n              newHeadEl.setAttribute(attr.nodeName, attr.nodeValue);\n            });\n\n            newHeadEl.onload = markLoaded.bind(null, 'link');\n            newHeadEl.onerror = markLoaded.bind(null, 'link');\n            domDoc.head.appendChild(newHeadEl);\n\n          }\n\n\n        });\n\n        if (styleCSS.length) {\n          let newHeadEl = domDoc.createElement('style');\n          newHeadEl.setAttribute('id', 'react-to-print');\n          newHeadEl.appendChild(domDoc.createTextNode(styleCSS));\n          domDoc.head.appendChild(newHeadEl);\n        }\n\n      }\n\n      if ((this.linkTotal === 0 || copyStyles === false) && !showPreview) {\n        this.triggerPrint(printWindow);\n      }\n    };\n\n    document.body.appendChild(printWindow);\n  }\n\n  render() {\n\n    return React.cloneElement(this.props.trigger(), {\n     ref: (el) => this.triggerRef = el,\n     onClick: this.handlePrint\n    });\n\n  }\n\n}\n\nexport default ReactToPrint;\n"],"names":["ReactToPrint","handlePrint","log","_this","props","content","copyStyles","showPreview","onAfterPrint","printButton","cancelButton","loadtriggered","printWindow","document","createElement","style","position","top","left","width","height","borderWidth","backgroundColor","contentEl","contentNodes","findDOMNode","linkNodes","querySelectorAll","linkTotal","length","linkLoaded","markLoaded","type","triggerPrint","onload","domDoc","contentDocument","contentWindow","open","write","outerHTML","close","styleEl","appendChild","createTextNode","head","printELe","React","cloneElement","printNode","addEventListener","manualPrint","render","className","body","cancelEle","cancelNode","display","removeWindow","headEls","styleCSS","forEach","node","tagName","sheet","i","cssRules","cssText","newHeadEl","attributes","setAttribute","attr","nodeName","nodeValue","bind","onerror","target","this","onBeforePrint","focus","print","parentNode","removeChild","trigger","el","_this3","triggerRef","Component","defaultProps"],"mappings":"2vCAIMA,gQA2DJC,YAAc,mBACJC,IAAI,qBAQRC,EAAKC,MANPC,IAAAA,QACAC,IAAAA,WAEAC,KADAC,eACAD,aACAE,IAAAA,YACAC,IAAAA,eAEGC,eAAe,MAEhBC,EAAcC,SAASC,cAAc,YAC7BC,MAAMC,SAAW,WAC1BT,KACWQ,MAAME,IAAM,QACZF,MAAMG,KAAO,QACbH,MAAMI,MAAQ,UACdJ,MAAMK,OAAS,UACfL,MAAMM,YAAc,YACpBN,MAAMO,gBAAkB,WAExBP,MAAME,IAAM,YACZF,MAAMG,KAAO,eAIrBK,EAAYlB,IACZmB,EAAeC,qBAAYF,GAE3BG,EAAYb,SAASc,iBAAiB,4BAEvCC,UAAYF,EAAUG,QAAU,IAChCC,WAAa,MAEZC,EAAa,SAACC,KAEbF,aAED3B,EAAK2B,aAAe3B,EAAKyB,WAAYrB,KAClC0B,aAAarB,MAKVsB,OAAS,eAChB/B,EAAKQ,iBAGHA,eAAe,MAEhBwB,EAASvB,EAAYwB,iBAAmBxB,EAAYyB,cAAcxB,WAE/DyB,SACAC,MAAMf,EAAagB,aACnBC,YAEHC,EAAUP,EAAOrB,cAAc,cAC3B6B,YAAYR,EAAOS,eACvB,6LAMGC,KAAKF,YAAYD,GAEpBjC,EAAa,KACXqC,EAAWC,MAAMC,aAAavC,EAAa,IAC3CwC,EAAYpC,SAASC,cAAc,SAC7BoC,iBAAiB,QAAS,aAC7BC,YAAYvC,uBAEVwC,OAAON,EAAUG,KAChBI,WAAa,+BAChBC,KAAKX,YAAYM,MAGtBvC,EAAc,KACZ6C,EAAYR,MAAMC,aAAatC,EAAc,IAC7C8C,EAAa3C,SAASC,cAAc,SAC7BoC,iBAAiB,QAAS,aACvBnC,MAAM0C,QAAU,SACvBC,aAAa9C,uBAEXwC,OAAOG,EAAWC,KAChBH,WAAa,gCACjBC,KAAKX,YAAYa,OAGP,IAAflD,EAAsB,KAElBqD,EAAU9C,SAASc,iBAAiB,iCACtCiC,EAAW,kCAEXD,IAASE,QAAQ,eAEE,UAAjBC,EAAKC,YAEHD,EAAKE,UACF,IAAIC,EAAI,EAAGA,EAAIH,EAAKE,MAAME,SAASrC,OAAQoC,OAClCH,EAAKE,MAAME,SAASD,GAAGE,QAAU,WAK5C,KAEDC,EAAYjC,EAAOrB,cAAcgD,EAAKC,qCAErBD,EAAKO,aACfR,QAAQ,cACPS,aAAaC,EAAKC,SAAUD,EAAKE,eAGnCvC,OAASH,EAAW2C,KAAK,KAAM,UAC/BC,QAAU5C,EAAW2C,KAAK,KAAM,UACnC7B,KAAKF,YAAYyB,MAOxBR,EAAS/B,OAAQ,KACfuC,EAAYjC,EAAOrB,cAAc,WAC3BwD,aAAa,KAAM,oBACnB3B,YAAYR,EAAOS,eAAegB,MACrCf,KAAKF,YAAYyB,IAKJ,IAAnBjE,EAAKyB,YAAkC,IAAftB,GAA0BC,KAChD0B,aAAarB,cAIb0C,KAAKX,YAAY/B,0GA5KfgE,cACPC,KAAKzE,MAAM0E,oBACR1E,MAAM0E,gBAETD,KAAKzE,MAAMG,eAQN8B,cAAc0C,UACd1C,cAAc2C,aAChBtB,aAAakB,eARP,aACFvC,cAAc0C,UACd1C,cAAc2C,UAChBtB,aAAakB,IACjB,yCAQKA,GACNC,KAAK/C,aAAe+C,KAAKjD,gBACtBK,aAAa2C,IAEU,IAA1BC,KAAKzE,MAAME,YAA2C,IAAnBuE,KAAKjD,gBACrCK,aAAa2C,wCAITA,KAEFK,WAAWC,YAAYN,sDAoJzB7B,MAAMC,aAAa6B,KAAKzE,MAAM+E,UAAW,KAC1C,SAACC,UAAOC,EAAKC,WAAaF,WACtBP,KAAK5E,qBA5MQ8C,MAAMwC,WAA3BvF,aAmBGwF,aAAe,aACR,mBACK,YACN"}